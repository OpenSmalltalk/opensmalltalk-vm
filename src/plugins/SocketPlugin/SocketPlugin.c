/* Automatically generated by
	SmartSyntaxPluginCodeGenerator VMMaker.oscog-eem.3224 uuid: 42ebfb68-9ff7-49b7-9cb0-0d8213e28160
   from
	SocketPlugin VMMaker.oscog-eem.3224 uuid: 42ebfb68-9ff7-49b7-9cb0-0d8213e28160
 */
static char __buildInfo[] = "SocketPlugin VMMaker.oscog-eem.3224 uuid: 42ebfb68-9ff7-49b7-9cb0-0d8213e28160 " __DATE__ ;


#include "config.h"
#include <math.h>
#include "sqMathShim.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>

/* Do not include the entire sq.h file but just those parts needed. */
#include "sqConfig.h"			/* Configuration options */
#include "sqVirtualMachine.h"	/*  The virtual machine proxy definition */
#include "sqPlatformSpecific.h"	/* Platform specific definitions */

#include "SocketPlugin.h"
#include "sqMemoryAccess.h"

#define true 1
#define false 0
#define null 0  /* using 'null' because nil is predefined in Think C */
#ifdef SQUEAK_BUILTIN_PLUGIN
# undef EXPORT
# define EXPORT(returnType) static returnType
# define INT_EXT "(i)"
#else
# define INT_EXT "(e)"
#endif


/*** Function Prototypes ***/
EXPORT(const char*) getModuleName(void);
EXPORT(sqInt) initialiseModule(void);
static sqInt intToNetAddress(sqInt addr);
EXPORT(sqInt) moduleUnloaded(char *aModuleName);
EXPORT(sqInt) primitiveDisableSocketAccess(void);
EXPORT(sqInt) primitiveHasSocketAccess(void);
EXPORT(sqInt) primitiveInitializeNetwork(void);
EXPORT(sqInt) primitiveResolverAbortLookup(void);
EXPORT(sqInt) primitiveResolverAddressLookupResult(void);
EXPORT(sqInt) primitiveResolverError(void);
EXPORT(sqInt) primitiveResolverGetAddressInfo(void);
EXPORT(sqInt) primitiveResolverGetAddressInfoFamily(void);
EXPORT(sqInt) primitiveResolverGetAddressInfoNext(void);
EXPORT(sqInt) primitiveResolverGetAddressInfoProtocol(void);
EXPORT(sqInt) primitiveResolverGetAddressInfoResult(void);
EXPORT(sqInt) primitiveResolverGetAddressInfoSize(void);
EXPORT(sqInt) primitiveResolverGetAddressInfoType(void);
EXPORT(sqInt) primitiveResolverGetNameInfo(void);
EXPORT(sqInt) primitiveResolverGetNameInfoHostResult(void);
EXPORT(sqInt) primitiveResolverGetNameInfoHostSize(void);
EXPORT(sqInt) primitiveResolverGetNameInfoServiceResult(void);
EXPORT(sqInt) primitiveResolverGetNameInfoServiceSize(void);
EXPORT(sqInt) primitiveResolverHostNameResult(void);
EXPORT(sqInt) primitiveResolverHostNameSize(void);
EXPORT(sqInt) primitiveResolverLocalAddress(void);
EXPORT(sqInt) primitiveResolverNameLookupResult(void);
EXPORT(sqInt) primitiveResolverStartAddressLookup(void);
EXPORT(sqInt) primitiveResolverStartNameLookup(void);
EXPORT(sqInt) primitiveResolverStatus(void);
EXPORT(sqInt) primitiveSocketAbortConnection(void);
EXPORT(sqInt) primitiveSocketAccept(void);
EXPORT(sqInt) primitiveSocketAccept3Semaphores(void);
EXPORT(sqInt) primitiveSocketAddressGetPort(void);
EXPORT(sqInt) primitiveSocketAddressSetPort(void);
EXPORT(sqInt) primitiveSocketBindTo(void);
EXPORT(sqInt) primitiveSocketBindToPort(void);
EXPORT(sqInt) primitiveSocketCloseConnection(void);
EXPORT(sqInt) primitiveSocketConnectionStatus(void);
EXPORT(sqInt) primitiveSocketConnectTo(void);
EXPORT(sqInt) primitiveSocketConnectToPort(void);
EXPORT(sqInt) primitiveSocketCreate(void);
EXPORT(sqInt) primitiveSocketCreate3Semaphores(void);
EXPORT(sqInt) primitiveSocketCreateRAW(void);
EXPORT(sqInt) primitiveSocketDestroy(void);
EXPORT(sqInt) primitiveSocketError(void);
EXPORT(sqInt) primitiveSocketGetOptions(void);
EXPORT(sqInt) primitiveSocketListenOnPort(void);
EXPORT(sqInt) primitiveSocketListenOnPortBacklog(void);
EXPORT(sqInt) primitiveSocketListenOnPortBacklogInterface(void);
EXPORT(sqInt) primitiveSocketListenWithBacklog(void);
EXPORT(sqInt) primitiveSocketListenWithOrWithoutBacklog(void);
EXPORT(sqInt) primitiveSocketLocalAddress(void);
EXPORT(sqInt) primitiveSocketLocalAddressResult(void);
EXPORT(sqInt) primitiveSocketLocalAddressSize(void);
EXPORT(sqInt) primitiveSocketLocalPort(void);
EXPORT(sqInt) primitiveSocketReceiveDataAvailable(void);
EXPORT(sqInt) primitiveSocketReceiveDataBufCount(void);
EXPORT(sqInt) primitiveSocketReceiveUDPDataBufCount(void);
EXPORT(sqInt) primitiveSocketRemoteAddress(void);
EXPORT(sqInt) primitiveSocketRemoteAddressResult(void);
EXPORT(sqInt) primitiveSocketRemoteAddressSize(void);
EXPORT(sqInt) primitiveSocketRemotePort(void);
EXPORT(sqInt) primitiveSocketSendDataBufCount(void);
EXPORT(sqInt) primitiveSocketSendDone(void);
EXPORT(sqInt) primitiveSocketSendUDPDataBufCount(void);
EXPORT(sqInt) primitiveSocketSetOptions(void);
EXPORT(sqInt) setInterpreter(struct VirtualMachine *anInterpreter);
EXPORT(sqInt) shutdownModule(void);


/*** Variables ***/

#if !defined(SQUEAK_BUILTIN_PLUGIN)
static sqInt (*byteSizeOf)(sqInt oop);
static sqInt (*bytesPerElement)(sqInt oop);
static sqInt (*classArray)(void);
static sqInt (*classByteArray)(void);
static sqInt (*classString)(void);
static sqInt (*failed)(void);
static sqInt (*falseObject)(void);
static void * (*firstIndexableField)(sqInt oop);
static sqInt (*instantiateClassindexableSize)(sqInt classPointer, sqInt size);
#if !defined(integerValueOf)
static sqInt (*integerValueOf)(sqInt oop);
#endif
static void * (*ioLoadFunctionFrom)(char *functionName, char *moduleName);
static sqInt (*isBytes)(sqInt oop);
#if !defined(isIntegerObject)
static sqInt (*isIntegerObject)(sqInt objectPointer);
#endif
static sqInt (*isWords)(sqInt oop);
static sqInt (*isWordsOrBytes)(sqInt oop);
static sqInt (*methodArgumentCount)(void);
static sqInt (*methodReturnBool)(sqInt boolean);
static sqInt (*methodReturnInteger)(sqInt integer);
static sqInt (*methodReturnValue)(sqInt oop);
static sqInt (*pop)(sqInt nItems);
static sqInt (*popRemappableOop)(void);
static sqInt (*primitiveFail)(void);
static sqInt (*primitiveFailFor)(sqInt reasonCode);
static sqInt (*pushRemappableOop)(sqInt oop);
static sqInt (*slotSizeOf)(sqInt oop);
static sqInt (*stackValue)(sqInt offset);
static sqInt (*storeIntegerofObjectwithValue)(sqInt index, sqInt oop, sqInt integer);
static sqInt (*storePointerofObjectwithValue)(sqInt index, sqInt oop, sqInt valuePointer);
static sqInt (*success)(sqInt aBoolean);
static sqInt (*trueObject)(void);
#else /* !defined(SQUEAK_BUILTIN_PLUGIN) */
extern sqInt byteSizeOf(sqInt oop);
#if VM_PROXY_MAJOR > 1 || (VM_PROXY_MAJOR == 1 && VM_PROXY_MINOR >= 17)
extern sqInt bytesPerElement(sqInt oop);
#else
# define bytesPerElement(oop) 0
#endif
extern sqInt classArray(void);
extern sqInt classByteArray(void);
extern sqInt classString(void);
extern sqInt failed(void);
extern sqInt falseObject(void);
extern void * firstIndexableField(sqInt oop);
extern sqInt instantiateClassindexableSize(sqInt classPointer, sqInt size);
#if !defined(integerValueOf)
extern sqInt integerValueOf(sqInt oop);
#endif
extern void * ioLoadFunctionFrom(char *functionName, char *moduleName);
extern sqInt isBytes(sqInt oop);
#if !defined(isIntegerObject)
extern sqInt isIntegerObject(sqInt objectPointer);
#endif
extern sqInt isWords(sqInt oop);
extern sqInt isWordsOrBytes(sqInt oop);
extern sqInt methodArgumentCount(void);
extern sqInt methodReturnBool(sqInt boolean);
extern sqInt methodReturnInteger(sqInt integer);
extern sqInt methodReturnValue(sqInt oop);
extern sqInt pop(sqInt nItems);
extern sqInt popRemappableOop(void);
extern sqInt primitiveFail(void);
extern sqInt primitiveFailFor(sqInt reasonCode);
extern sqInt pushRemappableOop(sqInt oop);
extern sqInt slotSizeOf(sqInt oop);
extern sqInt stackValue(sqInt offset);
extern sqInt storeIntegerofObjectwithValue(sqInt index, sqInt oop, sqInt integer);
extern sqInt storePointerofObjectwithValue(sqInt index, sqInt oop, sqInt valuePointer);
extern sqInt success(sqInt aBoolean);
extern sqInt trueObject(void);
extern
#endif
struct VirtualMachine* interpreterProxy;
static const char *moduleName = "SocketPlugin VMMaker.oscog-eem.3224 " INT_EXT;
static void * sCCLOPfn;
static void * sCCSOTfn;
static void * sCCTPfn;
static void * sDSAfn;
static void * sHSAfn;



/*	Note: This is hardcoded so it can be run from Squeak.
	The module name is used for validating a module *after*
	it is loaded to check if it does really contain the module
	we're thinking it contains. This is important! */

	/* InterpreterPlugin>>#getModuleName */
EXPORT(const char*)
getModuleName(void)
{
	return moduleName;
}

	/* SocketPlugin>>#initialiseModule */
EXPORT(sqInt)
initialiseModule(void)
{
	sDSAfn = ioLoadFunctionFrom("secDisableSocketAccess", "SecurityPlugin");
	sHSAfn = ioLoadFunctionFrom("secHasSocketAccess", "SecurityPlugin");
	sCCTPfn = ioLoadFunctionFrom("secCanConnectToPort", "SecurityPlugin");
	sCCLOPfn = ioLoadFunctionFrom("secCanListenOnPort", "SecurityPlugin");
	sCCSOTfn = ioLoadFunctionFrom("secCanCreateSocketOfType", "SecurityPlugin");
	return socketInit();
}


/*	Convert the given 32-bit integer into an internet network address
	represented as a four-byte ByteArray.
 */

	/* SocketPlugin>>#intToNetAddress: */
static sqInt
intToNetAddress(sqInt addr)
{
	char *naPtr;
	sqInt netAddressOop;

	netAddressOop = instantiateClassindexableSize(classByteArray(), 4);
	naPtr = ((char *)firstIndexableField(netAddressOop));
	naPtr[0] = (((char) ((((usqInt)(addr)) >> 24) & 0xFF)));
	naPtr[1] = (((char) ((((usqInt)(addr)) >> 16) & 0xFF)));
	naPtr[2] = (((char) ((((usqInt)(addr)) >> 8) & 0xFF)));
	naPtr[3] = (((char) (addr & 0xFF)));
	return netAddressOop;
}


/*	The module with the given name was just unloaded.
	Make sure we have no dangling references. */

	/* SocketPlugin>>#moduleUnloaded: */
EXPORT(sqInt)
moduleUnloaded(char *aModuleName)
{
	if ((strcmp(aModuleName, "SecurityPlugin")) == 0) {

		/* The security plugin just shut down. How odd. */
		sDSAfn = (sHSAfn = (sCCTPfn = (sCCLOPfn = (sCCSOTfn = 0))));
	}
	return 0;
}


/*	If the security plugin can be loaded, use it to turn off socket access
	If not, assume it's ok */

	/* SocketPlugin>>#primitiveDisableSocketAccess */
EXPORT(sqInt)
primitiveDisableSocketAccess(void)
{
	if (sDSAfn != 0) {
		((sqInt (*) (void)) sDSAfn)();
	}
	return 0;
}

	/* SocketPlugin>>#primitiveHasSocketAccess */
EXPORT(sqInt)
primitiveHasSocketAccess(void)
{
	methodReturnBool((sHSAfn == 0)
	 || ( ((sqInt (*) (void)) sHSAfn)()));
	return null;
}

	/* SocketPlugin>>#primitiveInitializeNetwork: */
EXPORT(sqInt)
primitiveInitializeNetwork(void)
{
	sqInt err;
	sqInt resolverSemaIndex;

	if (!(isIntegerObject((resolverSemaIndex = stackValue(0))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	resolverSemaIndex = integerValueOf(resolverSemaIndex);
	err = sqNetworkInit(resolverSemaIndex);
	success(err == 0);
	if (!(failed())) {
		pop(1);
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverAbortLookup */
EXPORT(sqInt)
primitiveResolverAbortLookup(void)
{
	sqResolverAbort();
	return null;
}

	/* SocketPlugin>>#primitiveResolverAddressLookupResult */
EXPORT(sqInt)
primitiveResolverAddressLookupResult(void)
{
	sqInt s;
	sqInt sz;

	s = 0;
	sz = sqResolverAddrLookupResultSize();
	if (!(failed())) {
		s = instantiateClassindexableSize(classString(), sz);
		sqResolverAddrLookupResult(((char *)firstIndexableField(s)), sz);
	}
	if (!(failed())) {
		methodReturnValue(s);
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverError */
EXPORT(sqInt)
primitiveResolverError(void)
{
	methodReturnInteger(sqResolverError());
	return null;
}

	/* SocketPlugin>>#primitiveResolverGetAddressInfoHost:service:flags:family:type:protocol: */
EXPORT(sqInt)
primitiveResolverGetAddressInfo(void)
{
	sqInt family;
	sqInt flags;
	char *hostName;
	sqInt hostSize;
	sqInt protocol;
	char *servName;
	sqInt servSize;
	sqInt type;

	if (!((isBytes(stackValue(5)))
		 && ((isBytes(stackValue(4)))
		 && ((isIntegerObject((flags = stackValue(3))))
		 && ((isIntegerObject((family = stackValue(2))))
		 && ((isIntegerObject((type = stackValue(1))))
		 && (isIntegerObject((protocol = stackValue(0)))))))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	hostName = firstIndexableField(stackValue(5));
	servName = firstIndexableField(stackValue(4));
	flags = integerValueOf(flags);
	family = integerValueOf(family);
	type = integerValueOf(type);
	protocol = integerValueOf(protocol);
	if (!(failed())) {
		hostSize = byteSizeOf(((sqInt)(sqIntptr_t)(hostName) - BaseHeaderSize));
		servSize = byteSizeOf(((sqInt)(sqIntptr_t)(servName) - BaseHeaderSize));
		sqResolverGetAddressInfoHostSizeServiceSizeFlagsFamilyTypeProtocol(hostName, hostSize, servName, servSize, flags, family, type, protocol);
	}
	if (!(failed())) {
		pop(6);
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverGetAddressInfoFamily */
EXPORT(sqInt)
primitiveResolverGetAddressInfoFamily(void)
{
	sqInt family;

	if (!(failed())) {
		family = sqResolverGetAddressInfoFamily();
		if (!(failed())) {
			methodReturnInteger(family);
		}
		return null;
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverGetAddressInfoNext */
EXPORT(sqInt)
primitiveResolverGetAddressInfoNext(void)
{
	sqInt more;

	more = sqResolverGetAddressInfoNext();
	if (failed()) {
		return null;
	}
	if (!(failed())) {
		methodReturnBool(more);
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverGetAddressInfoProtocol */
EXPORT(sqInt)
primitiveResolverGetAddressInfoProtocol(void)
{
	sqInt protocol;

	if (!(failed())) {
		protocol = sqResolverGetAddressInfoProtocol();
		if (!(failed())) {
			methodReturnInteger(protocol);
		}
		return null;
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverGetAddressInfoResult: */
EXPORT(sqInt)
primitiveResolverGetAddressInfoResult(void)
{
	sqInt addrSize;
	char *socketAddress;

	if (!(isBytes(stackValue(0)))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	socketAddress = firstIndexableField(stackValue(0));
	if (!(failed())) {
		addrSize = byteSizeOf(((sqInt)(sqIntptr_t)(socketAddress) - BaseHeaderSize));
		sqResolverGetAddressInfoResultSize(socketAddress, addrSize);
	}
	if (!(failed())) {
		pop(1);
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverGetAddressInfoSize */
EXPORT(sqInt)
primitiveResolverGetAddressInfoSize(void)
{
	sqInt size;

	if (!(failed())) {
		size = sqResolverGetAddressInfoSize();
		if (!(failed())) {
			methodReturnInteger(size);
		}
		return null;
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverGetAddressInfoType */
EXPORT(sqInt)
primitiveResolverGetAddressInfoType(void)
{
	sqInt type;

	if (!(failed())) {
		type = sqResolverGetAddressInfoType();
		if (!(failed())) {
			methodReturnInteger(type);
		}
		return null;
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverGetNameInfo:flags: */
EXPORT(sqInt)
primitiveResolverGetNameInfo(void)
{
	char *addrBase;
	sqInt addrSize;
	sqInt flags;
	sqInt socketAddress;

	if (!(isIntegerObject((flags = stackValue(0))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	socketAddress = stackValue(1);
	flags = integerValueOf(flags);
	if (!(failed())) {
		addrSize = byteSizeOf(socketAddress);
		addrBase = ((char *) (firstIndexableField(socketAddress)));
		sqResolverGetNameInfoSizeFlags(addrBase, addrSize, flags);
	}
	if (!(failed())) {
		pop(2);
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverGetNameInfoHostResult: */
EXPORT(sqInt)
primitiveResolverGetNameInfoHostResult(void)
{
	sqInt addrSize;
	char *socketName;

	if (!(isBytes(stackValue(0)))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	socketName = firstIndexableField(stackValue(0));
	if (!(failed())) {
		addrSize = byteSizeOf(((sqInt)(sqIntptr_t)(socketName) - BaseHeaderSize));
		sqResolverGetNameInfoHostResultSize(socketName, addrSize);
	}
	if (!(failed())) {
		pop(1);
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverGetNameInfoHostSize */
EXPORT(sqInt)
primitiveResolverGetNameInfoHostSize(void)
{
	sqInt size;

	if (!(failed())) {
		size = sqResolverGetNameInfoHostSize();
		if (!(failed())) {
			methodReturnInteger(size);
		}
		return null;
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverGetNameInfoServiceResult: */
EXPORT(sqInt)
primitiveResolverGetNameInfoServiceResult(void)
{
	sqInt addrSize;
	char *socketName;

	if (!(isBytes(stackValue(0)))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	socketName = firstIndexableField(stackValue(0));
	if (!(failed())) {
		addrSize = byteSizeOf(((sqInt)(sqIntptr_t)(socketName) - BaseHeaderSize));
		sqResolverGetNameInfoServiceResultSize(socketName, addrSize);
	}
	if (!(failed())) {
		pop(1);
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverGetNameInfoServiceSize */
EXPORT(sqInt)
primitiveResolverGetNameInfoServiceSize(void)
{
	sqInt size;

	if (!(failed())) {
		size = sqResolverGetNameInfoServiceSize();
		if (!(failed())) {
			methodReturnInteger(size);
		}
		return null;
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverHostNameResult: */
EXPORT(sqInt)
primitiveResolverHostNameResult(void)
{
	sqInt nameSize;
	char *nameString;

	if (!(isBytes(stackValue(0)))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	nameString = firstIndexableField(stackValue(0));
	if (!(failed())) {
		nameSize = byteSizeOf(((sqInt)(sqIntptr_t)(nameString) - BaseHeaderSize));
		sqResolverHostNameResultSize(nameString, nameSize);
	}
	if (!(failed())) {
		pop(1);
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverHostNameSize */
EXPORT(sqInt)
primitiveResolverHostNameSize(void)
{
	sqInt size;

	if (!(failed())) {
		size = sqResolverHostNameSize();
		if (!(failed())) {
			methodReturnInteger(size);
			return null;
		}
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverLocalAddress */
EXPORT(sqInt)
primitiveResolverLocalAddress(void)
{
	sqInt addr;
	sqInt _return_value;

	addr = sqResolverLocalAddress();
	if (!(failed())) {
		_return_value = intToNetAddress(addr);
		if (!(failed())) {
			methodReturnValue(_return_value);
		}
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverNameLookupResult */
EXPORT(sqInt)
primitiveResolverNameLookupResult(void)
{
	sqInt addr;
	sqInt _return_value;

	addr = sqResolverNameLookupResult();
	if (!(failed())) {
		_return_value = intToNetAddress(addr);
		if (!(failed())) {
			methodReturnValue(_return_value);
		}
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverStartAddressLookup: */
EXPORT(sqInt)
primitiveResolverStartAddressLookup(void)
{
	sqInt addr;
	char *address;
	sqInt sz;

	if (!(isBytes(stackValue(0)))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	address = firstIndexableField(stackValue(0));
	/* begin netAddressToInt: */
	sz = byteSizeOf(((sqInt)(sqIntptr_t)((((unsigned char *) address))) - BaseHeaderSize));
	if (!(sz == 4)) {
		addr = primitiveFail();
		goto l1;
	}
	addr = ((((((unsigned char *) address))[3]) + (((usqInt)(((((unsigned char *) address))[2])) << 8))) + (((usqInt)(((((unsigned char *) address))[1])) << 16))) + (((usqInt)(((*((unsigned char *) address)))) << 24));
	l1:	/* end netAddressToInt: */;
	if (!(failed())) {
		sqResolverStartAddrLookup(addr);
	}
	if (!(failed())) {
		pop(1);
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverStartNameLookup: */
EXPORT(sqInt)
primitiveResolverStartNameLookup(void)
{
	char *name;
	sqInt sz;

	if (!(isBytes(stackValue(0)))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	name = firstIndexableField(stackValue(0));
	if (!(failed())) {
		sz = byteSizeOf(((sqInt)(sqIntptr_t)(name) - BaseHeaderSize));
		sqResolverStartNameLookup(name, sz);
	}
	if (!(failed())) {
		pop(1);
	}
	return null;
}

	/* SocketPlugin>>#primitiveResolverStatus */
EXPORT(sqInt)
primitiveResolverStatus(void)
{
	sqInt status;

	status = sqResolverStatus();
	if (!(failed())) {
		methodReturnInteger(status);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketAbortConnection: */
EXPORT(sqInt)
primitiveSocketAbortConnection(void)
{
	SocketPtr s;
	sqInt socket;

	socket = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (!(failed())) {
		sqSocketAbortConnection(s);
	}
	if (!(failed())) {
		pop(1);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketAcceptFrom:rcvBufferSize:sndBufSize:semaIndex: */
EXPORT(sqInt)
primitiveSocketAccept(void)
{
	sqInt recvBufSize;
	SocketPtr s;
	sqInt semaIndex;
	sqInt sendBufSize;
	SocketPtr serverSocket;
	sqInt socketOop;
	sqInt sockHandle;

	if (!((isIntegerObject((recvBufSize = stackValue(2))))
		 && ((isIntegerObject((sendBufSize = stackValue(1))))
		 && (isIntegerObject((semaIndex = stackValue(0))))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	sockHandle = stackValue(3);
	recvBufSize = integerValueOf(recvBufSize);
	sendBufSize = integerValueOf(sendBufSize);
	semaIndex = integerValueOf(semaIndex);
	/* begin socketValueOf: */
	if ((isBytes(sockHandle))
	 && ((byteSizeOf(sockHandle)) == (sizeof(SQSocket)))) {
		serverSocket = ((SocketPtr) (firstIndexableField(sockHandle)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		serverSocket = null;
	}
	if (!(failed())) {
		socketOop = instantiateClassindexableSize(classByteArray(), sizeof(SQSocket));
		/* begin socketValueOf: */
		if ((isBytes(socketOop))
		 && ((byteSizeOf(socketOop)) == (sizeof(SQSocket)))) {
			s = ((SocketPtr) (firstIndexableField(socketOop)));
		}
		else {
			primitiveFailFor(PrimErrBadArgument);
			s = null;
		}
		if (!(failed())) {
			sqSocketAcceptFromRecvBytesSendBytesSemaID(s, serverSocket, recvBufSize, sendBufSize, semaIndex);
			if (!(failed())) {
				methodReturnValue(socketOop);
			}
			return null;
		}
	}
	if (!(failed())) {
		pop(4);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketAcceptFrom:rcvBufferSize:sndBufSize:semaIndex:readSemaIndex:writeSemaIndex: */
EXPORT(sqInt)
primitiveSocketAccept3Semaphores(void)
{
	sqInt aReadSema;
	sqInt aWriteSema;
	sqInt recvBufSize;
	SocketPtr s;
	sqInt semaIndex;
	sqInt sendBufSize;
	SocketPtr serverSocket;
	sqInt socketOop;
	sqInt sockHandle;

	if (!((isIntegerObject((recvBufSize = stackValue(4))))
		 && ((isIntegerObject((sendBufSize = stackValue(3))))
		 && ((isIntegerObject((semaIndex = stackValue(2))))
		 && ((isIntegerObject((aReadSema = stackValue(1))))
		 && (isIntegerObject((aWriteSema = stackValue(0))))))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	sockHandle = stackValue(5);
	recvBufSize = integerValueOf(recvBufSize);
	sendBufSize = integerValueOf(sendBufSize);
	semaIndex = integerValueOf(semaIndex);
	aReadSema = integerValueOf(aReadSema);
	aWriteSema = integerValueOf(aWriteSema);
	/* begin socketValueOf: */
	if ((isBytes(sockHandle))
	 && ((byteSizeOf(sockHandle)) == (sizeof(SQSocket)))) {
		serverSocket = ((SocketPtr) (firstIndexableField(sockHandle)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		serverSocket = null;
	}
	if (!(failed())) {
		socketOop = instantiateClassindexableSize(classByteArray(), sizeof(SQSocket));
		/* begin socketValueOf: */
		if ((isBytes(socketOop))
		 && ((byteSizeOf(socketOop)) == (sizeof(SQSocket)))) {
			s = ((SocketPtr) (firstIndexableField(socketOop)));
		}
		else {
			primitiveFailFor(PrimErrBadArgument);
			s = null;
		}
		if (!(failed())) {
			sqSocketAcceptFromRecvBytesSendBytesSemaIDReadSemaIDWriteSemaID(s, serverSocket, recvBufSize, sendBufSize, semaIndex, aReadSema, aWriteSema);
			if (!(failed())) {
				methodReturnValue(socketOop);
			}
			return null;
		}
	}
	if (!(failed())) {
		pop(6);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketAddressGetPort */
EXPORT(sqInt)
primitiveSocketAddressGetPort(void)
{
	sqInt addr;
	char *addrBase;
	sqInt addrSize;
	sqInt port;

	addr = stackValue(0);
	addrSize = byteSizeOf(addr);
	addrBase = ((char *) (firstIndexableField(addr)));
	if (!(failed())) {
		port = sqSocketAddressSizeGetPort(addrBase, addrSize);
		if (!(failed())) {
			methodReturnInteger(port);
			return null;
		}
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketAddressSetPort: */
EXPORT(sqInt)
primitiveSocketAddressSetPort(void)
{
	sqInt addr;
	char *addrBase;
	sqInt addrSize;
	sqInt portNumber;

	if (!(isIntegerObject((portNumber = stackValue(0))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	portNumber = integerValueOf(portNumber);
	addr = stackValue(1);
	addrSize = byteSizeOf(addr);
	addrBase = ((char *) (firstIndexableField(addr)));
	if (!(failed())) {
		sqSocketAddressSizeSetPort(addrBase, addrSize, portNumber);
	}
	if (!(failed())) {
		pop(1);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocket:bindTo: */
EXPORT(sqInt)
primitiveSocketBindTo(void)
{
	char *addrBase;
	sqInt addrSize;
	SocketPtr s;
	sqInt socket;
	sqInt socketAddress;

	socket = stackValue(1);
	socketAddress = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	addrSize = byteSizeOf(socketAddress);
	addrBase = ((char *) (firstIndexableField(socketAddress)));
	if (!(failed())) {
		sqSocketBindToAddressSize(s, addrBase, addrSize);
	}
	if (!(failed())) {
		pop(2);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocket:bindTo:port: */
EXPORT(sqInt)
primitiveSocketBindToPort(void)
{
	sqInt addr;
	char *address;
	sqInt port;
	SocketPtr s;
	sqInt socket;
	sqInt sz;

	if (!((isBytes(stackValue(1)))
		 && (isIntegerObject((port = stackValue(0)))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	socket = stackValue(2);
	address = firstIndexableField(stackValue(1));
	port = integerValueOf(port);
	/* begin netAddressToInt: */
	sz = byteSizeOf(((sqInt)(sqIntptr_t)((((unsigned char *) address))) - BaseHeaderSize));
	if (!(sz == 4)) {
		addr = primitiveFail();
		goto l1;
	}
	addr = ((((((unsigned char *) address))[3]) + (((usqInt)(((((unsigned char *) address))[2])) << 8))) + (((usqInt)(((((unsigned char *) address))[1])) << 16))) + (((usqInt)(((*((unsigned char *) address)))) << 24));
	l1:	/* end netAddressToInt: */;
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (!(failed())) {
		sqSocketBindToPort(s, addr, port);
	}
	if (!(failed())) {
		pop(3);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketCloseConnection: */
EXPORT(sqInt)
primitiveSocketCloseConnection(void)
{
	SocketPtr s;
	sqInt socket;

	socket = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (!(failed())) {
		sqSocketCloseConnection(s);
	}
	if (!(failed())) {
		pop(1);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketConnectionStatus: */
EXPORT(sqInt)
primitiveSocketConnectionStatus(void)
{
	SocketPtr s;
	sqInt socket;
	sqInt status;

	status = 0;
	socket = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (!(failed())) {
		status = sqSocketConnectionStatus(s);
	}
	if (!(failed())) {
		methodReturnInteger(status);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocket:connectTo: */
EXPORT(sqInt)
primitiveSocketConnectTo(void)
{
	char *addrBase;
	sqInt addrSize;
	SocketPtr s;
	sqInt socket;
	sqInt socketAddress;

	socket = stackValue(1);
	socketAddress = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	addrSize = byteSizeOf(socketAddress);
	addrBase = ((char *) (firstIndexableField(socketAddress)));
	if (!(failed())) {
		sqSocketConnectToAddressSize(s, addrBase, addrSize);
	}
	if (!(failed())) {
		pop(2);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocket:connectTo:port: */
EXPORT(sqInt)
primitiveSocketConnectToPort(void)
{
	sqInt addr;
	char *address;
	sqInt okToConnect;
	sqInt port;
	SocketPtr s;
	sqInt socket;
	sqInt sz;

	if (!((isBytes(stackValue(1)))
		 && (isIntegerObject((port = stackValue(0)))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	socket = stackValue(2);
	address = firstIndexableField(stackValue(1));
	port = integerValueOf(port);
	/* begin netAddressToInt: */
	sz = byteSizeOf(((sqInt)(sqIntptr_t)((((unsigned char *) address))) - BaseHeaderSize));
	if (!(sz == 4)) {
		addr = primitiveFail();
		goto l1;
	}
	addr = ((((((unsigned char *) address))[3]) + (((usqInt)(((((unsigned char *) address))[2])) << 8))) + (((usqInt)(((((unsigned char *) address))[1])) << 16))) + (((usqInt)(((*((unsigned char *) address)))) << 24));
	l1:	/* end netAddressToInt: */;
	if (sCCTPfn != 0) {
		okToConnect =  ((sqInt (*) (sqInt, sqInt)) sCCTPfn)(addr, port);
		if (!okToConnect) {
			return primitiveFail();
		}
	}
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (!(failed())) {
		sqSocketConnectToPort(s, addr, port);
	}
	if (!(failed())) {
		pop(3);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketCreateNetwork:type:receiveBufferSize:sendBufSize:semaIndex: */
EXPORT(sqInt)
primitiveSocketCreate(void)
{
	sqInt netType;
	sqInt okToCreate;
	sqInt recvBufSize;
	SocketPtr s;
	sqInt semaIndex;
	sqInt sendBufSize;
	sqInt socketOop;
	sqInt socketType;

	if (!((isIntegerObject((netType = stackValue(4))))
		 && ((isIntegerObject((socketType = stackValue(3))))
		 && ((isIntegerObject((recvBufSize = stackValue(2))))
		 && ((isIntegerObject((sendBufSize = stackValue(1))))
		 && (isIntegerObject((semaIndex = stackValue(0))))))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	netType = integerValueOf(netType);
	socketType = integerValueOf(socketType);
	recvBufSize = integerValueOf(recvBufSize);
	sendBufSize = integerValueOf(sendBufSize);
	semaIndex = integerValueOf(semaIndex);
	if (sCCSOTfn != 0) {
		okToCreate =  ((sqInt (*) (sqInt, sqInt)) sCCSOTfn)(netType, socketType);
		if (!okToCreate) {
			return primitiveFail();
		}
	}
	socketOop = instantiateClassindexableSize(classByteArray(), sizeof(SQSocket));
	/* begin socketValueOf: */
	if ((isBytes(socketOop))
	 && ((byteSizeOf(socketOop)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socketOop)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (!(failed())) {
		sqSocketCreateNetTypeSocketTypeRecvBytesSendBytesSemaID(s, netType, socketType, recvBufSize, sendBufSize, semaIndex);
		if (!(failed())) {
			methodReturnValue(socketOop);
		}
		return null;
	}
	if (!(failed())) {
		pop(5);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketCreateNetwork:type:receiveBufferSize:sendBufSize:semaIndex:readSemaIndex:writeSemaIndex: */
EXPORT(sqInt)
primitiveSocketCreate3Semaphores(void)
{
	sqInt aReadSema;
	sqInt aWriteSema;
	sqInt netType;
	sqInt okToCreate;
	sqInt recvBufSize;
	SocketPtr s;
	sqInt semaIndex;
	sqInt sendBufSize;
	sqInt socketOop;
	sqInt socketType;

	if (!((isIntegerObject((netType = stackValue(6))))
		 && ((isIntegerObject((socketType = stackValue(5))))
		 && ((isIntegerObject((recvBufSize = stackValue(4))))
		 && ((isIntegerObject((sendBufSize = stackValue(3))))
		 && ((isIntegerObject((semaIndex = stackValue(2))))
		 && ((isIntegerObject((aReadSema = stackValue(1))))
		 && (isIntegerObject((aWriteSema = stackValue(0))))))))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	netType = integerValueOf(netType);
	socketType = integerValueOf(socketType);
	recvBufSize = integerValueOf(recvBufSize);
	sendBufSize = integerValueOf(sendBufSize);
	semaIndex = integerValueOf(semaIndex);
	aReadSema = integerValueOf(aReadSema);
	aWriteSema = integerValueOf(aWriteSema);
	if (sCCSOTfn != 0) {
		okToCreate =  ((sqInt (*) (sqInt, sqInt)) sCCSOTfn)(netType, socketType);
		if (!okToCreate) {
			return primitiveFail();
		}
	}
	socketOop = instantiateClassindexableSize(classByteArray(), sizeof(SQSocket));
	/* begin socketValueOf: */
	if ((isBytes(socketOop))
	 && ((byteSizeOf(socketOop)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socketOop)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (!(failed())) {
		sqSocketCreateNetTypeSocketTypeRecvBytesSendBytesSemaIDReadSemaIDWriteSemaID(s, netType, socketType, recvBufSize, sendBufSize, semaIndex, aReadSema, aWriteSema);
		if (!(failed())) {
			methodReturnValue(socketOop);
		}
		return null;
	}
	if (!(failed())) {
		pop(7);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketCreateRaw:type:receiveBufferSize:sendBufSize:semaIndex:readSemaIndex:writeSemaIndex: */
EXPORT(sqInt)
primitiveSocketCreateRAW(void)
{
	sqInt aReadSema;
	sqInt aWriteSema;
	sqInt netType;
	sqInt okToCreate;
	sqInt protoType;
	sqInt recvBufSize;
	SocketPtr s;
	sqInt semaIndex;
	sqInt sendBufSize;
	sqInt socketOop;

	if (!((isIntegerObject((netType = stackValue(6))))
		 && ((isIntegerObject((protoType = stackValue(5))))
		 && ((isIntegerObject((recvBufSize = stackValue(4))))
		 && ((isIntegerObject((sendBufSize = stackValue(3))))
		 && ((isIntegerObject((semaIndex = stackValue(2))))
		 && ((isIntegerObject((aReadSema = stackValue(1))))
		 && (isIntegerObject((aWriteSema = stackValue(0))))))))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	netType = integerValueOf(netType);
	protoType = integerValueOf(protoType);
	recvBufSize = integerValueOf(recvBufSize);
	sendBufSize = integerValueOf(sendBufSize);
	semaIndex = integerValueOf(semaIndex);
	aReadSema = integerValueOf(aReadSema);
	aWriteSema = integerValueOf(aWriteSema);
	if (sCCSOTfn != 0) {
		okToCreate =  ((sqInt (*) (sqInt, sqInt)) sCCSOTfn)(netType, protoType);
		if (!okToCreate) {
			return primitiveFail();
		}
	}
	socketOop = instantiateClassindexableSize(classByteArray(), sizeof(SQSocket));
	/* begin socketValueOf: */
	if ((isBytes(socketOop))
	 && ((byteSizeOf(socketOop)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socketOop)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (!(failed())) {
		sqSocketCreateRawProtoTypeRecvBytesSendBytesSemaIDReadSemaIDWriteSemaID(s, netType, protoType, recvBufSize, sendBufSize, semaIndex, aReadSema, aWriteSema);
		if (!(failed())) {
			methodReturnValue(socketOop);
		}
		return null;
	}
	if (!(failed())) {
		pop(7);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketDestroy: */
EXPORT(sqInt)
primitiveSocketDestroy(void)
{
	SocketPtr s;
	sqInt socket;

	socket = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (!(failed())) {
		sqSocketDestroy(s);
	}
	if (!(failed())) {
		pop(1);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketError: */
EXPORT(sqInt)
primitiveSocketError(void)
{
	SocketPtr s;
	sqInt socket;

	socket = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (!(failed())) {
		methodReturnInteger(sqSocketError(s));
		return null;
	}
	return 0;
}

	/* SocketPlugin>>#primitiveSocket:getOptions: */
EXPORT(sqInt)
primitiveSocketGetOptions(void)
{
	sqInt errorCode;
	sqInt optionName;
	sqInt results;
	sqInt returnedValue;
	SocketPtr s;
	sqInt socket;

	socket = stackValue(1);
	optionName = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	success(isBytes(optionName));
	if (failed()) {
		return null;
	}
	returnedValue = 0;
	errorCode = sqSocketGetOptionsoptionNameStartoptionNameSizereturnedValue(s, ((char *) (firstIndexableField(optionName))), byteSizeOf(optionName), (&returnedValue));
	results = instantiateClassindexableSize(classArray(), 2);
	storeIntegerofObjectwithValue(0, results, errorCode);
	storeIntegerofObjectwithValue(1, results, returnedValue);
	if (!(failed())) {
		methodReturnValue(results);
	}
	return null;
}


/*	one part of the wierdass dual prim primitiveSocketListenOnPort which 
	was warped by some demented evil person determined to twist the very 
	nature of reality */

	/* SocketPlugin>>#primitiveSocket:listenOnPort: */
EXPORT(sqInt)
primitiveSocketListenOnPort(void)
{
	sqInt okToListen;
	sqInt port;
	SocketPtr s;
	sqInt socket;

	if (!(isIntegerObject((port = stackValue(0))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	socket = stackValue(1);
	port = integerValueOf(port);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (sCCLOPfn != 0) {
		okToListen =  ((sqInt (*) (sqInt, sqInt)) sCCLOPfn)((sqInt)s, port);
		if (!okToListen) {
			return primitiveFail();
		}
	}
	if (!(failed())) {
		sqSocketListenOnPort(s, port);
	}
	if (!(failed())) {
		pop(2);
	}
	return null;
}


/*	second part of the wierdass dual prim primitiveSocketListenOnPort 
	which was warped by some demented evil person determined to twist the 
	very nature of reality */

	/* SocketPlugin>>#primitiveSocket:listenOnPort:backlogSize: */
EXPORT(sqInt)
primitiveSocketListenOnPortBacklog(void)
{
	sqInt backlog;
	sqInt okToListen;
	sqInt port;
	SocketPtr s;
	sqInt socket;

	if (!((isIntegerObject((port = stackValue(1))))
		 && (isIntegerObject((backlog = stackValue(0)))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	socket = stackValue(2);
	port = integerValueOf(port);
	backlog = integerValueOf(backlog);
	if (sCCLOPfn != 0) {
		okToListen =  ((sqInt (*) (sqInt, sqInt)) sCCLOPfn)((sqInt)s, port);
		if (!okToListen) {
			return primitiveFail();
		}
	}
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (!(failed())) {
		sqSocketListenOnPortBacklogSize(s, port, backlog);
	}
	if (!(failed())) {
		pop(3);
	}
	return null;
}


/*	Bind a socket to the given port and interface address with no more than
	backlog pending connections. The socket can be UDP, in which case the
	backlog should be specified as zero.
 */

	/* SocketPlugin>>#primitiveSocket:listenOnPort:backlogSize:interface: */
EXPORT(sqInt)
primitiveSocketListenOnPortBacklogInterface(void)
{
	sqInt addr;
	sqInt backlog;
	char *ifAddr;
	sqInt okToListen;
	sqInt port;
	SocketPtr s;
	sqInt socket;
	sqInt sz;

	if (!((isIntegerObject((port = stackValue(2))))
		 && ((isIntegerObject((backlog = stackValue(1))))
		 && (isBytes(stackValue(0)))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	socket = stackValue(3);
	port = integerValueOf(port);
	backlog = integerValueOf(backlog);
	ifAddr = firstIndexableField(stackValue(0));
	if (sCCLOPfn != 0) {
		okToListen =  ((sqInt (*) (sqInt, sqInt)) sCCLOPfn)((sqInt)s, port);
		if (!okToListen) {
			return primitiveFail();
		}
	}
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	/* begin netAddressToInt: */
	sz = byteSizeOf(((sqInt)(sqIntptr_t)((((unsigned char *) ifAddr))) - BaseHeaderSize));
	if (!(sz == 4)) {
		addr = primitiveFail();
		goto l1;
	}
	addr = ((((((unsigned char *) ifAddr))[3]) + (((usqInt)(((((unsigned char *) ifAddr))[2])) << 8))) + (((usqInt)(((((unsigned char *) ifAddr))[1])) << 16))) + (((usqInt)(((*((unsigned char *) ifAddr)))) << 24));
	l1:	/* end netAddressToInt: */;
	if (!(failed())) {
		sqSocketListenOnPortBacklogSizeInterface(s, port, backlog, addr);
	}
	if (!(failed())) {
		pop(4);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocket:listenWithBacklog: */
EXPORT(sqInt)
primitiveSocketListenWithBacklog(void)
{
	sqInt backlogSize;
	SocketPtr s;
	sqInt socket;

	if (!(isIntegerObject((backlogSize = stackValue(0))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	socket = stackValue(1);
	backlogSize = integerValueOf(backlogSize);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (!(failed())) {
		sqSocketListenBacklog(s, backlogSize);
	}
	if (!(failed())) {
		pop(2);
	}
	return null;
}


/*	Backward compatibility */

	/* SocketPlugin>>#primitiveSocketListenWithOrWithoutBacklog */
EXPORT(sqInt)
primitiveSocketListenWithOrWithoutBacklog(void)
{
	if ((methodArgumentCount()) == 2) {
		return primitiveSocketListenOnPort();
	}
	else {
		return primitiveSocketListenOnPortBacklog();
	}
}

	/* SocketPlugin>>#primitiveSocketLocalAddress: */
EXPORT(sqInt)
primitiveSocketLocalAddress(void)
{
	sqInt addr;
	SocketPtr s;
	sqInt socket;
	sqInt _return_value;

	socket = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	addr = sqSocketLocalAddress(s);
	if (!(failed())) {
		_return_value = intToNetAddress(addr);
		if (!(failed())) {
			methodReturnValue(_return_value);
		}
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocket:localAddressResult: */
EXPORT(sqInt)
primitiveSocketLocalAddressResult(void)
{
	char *addrBase;
	sqInt addrSize;
	SocketPtr s;
	sqInt socket;
	sqInt socketAddress;

	socket = stackValue(1);
	socketAddress = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	addrSize = byteSizeOf(socketAddress);
	addrBase = ((char *) (firstIndexableField(socketAddress)));
	if (!(failed())) {
		sqSocketLocalAddressResultSize(s, addrBase, addrSize);
	}
	if (!(failed())) {
		pop(2);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketLocalAddressSize: */
EXPORT(sqInt)
primitiveSocketLocalAddressSize(void)
{
	SocketPtr s;
	sqInt size;
	sqInt socket;

	socket = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (!(failed())) {
		size = sqSocketLocalAddressSize(s);
		if (!(failed())) {
			methodReturnInteger(size);
			return null;
		}
	}
	if (!(failed())) {
		pop(1);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketLocalPort: */
EXPORT(sqInt)
primitiveSocketLocalPort(void)
{
	sqInt port;
	SocketPtr s;
	sqInt socket;

	socket = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	port = sqSocketLocalPort(s);
	if (!(failed())) {
		methodReturnInteger(port);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketReceiveDataAvailable: */
EXPORT(sqInt)
primitiveSocketReceiveDataAvailable(void)
{
	SocketPtr s;
	sqInt socket;

	socket = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (!(failed())) {
		methodReturnBool(sqSocketReceiveDataAvailable(s));
		return null;
	}
	return 0;
}

	/* SocketPlugin>>#primitiveSocket:receiveDataBuf:start:count: */
EXPORT(sqInt)
primitiveSocketReceiveDataBufCount(void)
{
	sqInt array;
	char *arrayBase;
	sqInt bytesReceived;
	sqInt count;
	sqInt elementSize;
	SocketPtr s;
	sqInt socket;
	sqInt startIndex;

	if (!((isIntegerObject((startIndex = stackValue(1))))
		 && (isIntegerObject((count = stackValue(0)))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	socket = stackValue(3);
	array = stackValue(2);
	startIndex = integerValueOf(startIndex);
	count = integerValueOf(count);
	elementSize = 
#  if SPURVM
		bytesPerElement(array)
#  else
		(isWords(array)
				? 4
				: 1)
#  endif
		;
	if (!((isWordsOrBytes(array))
		 && ((elementSize > 0)
		 && ((startIndex >= 1)
		 && ((count >= 0)
		 && (((startIndex + count) - 1) <= (slotSizeOf(array)))))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (!(failed())) {

		/* Note: adjust bufStart for zero-origin indexing */
		arrayBase = ((char *) (firstIndexableField(array)));
		bytesReceived = sqSocketReceiveDataBufCount(s, arrayBase + ((startIndex - 1) * elementSize), count * elementSize);
		if (!(failed())) {
			methodReturnInteger(bytesReceived / elementSize);
		}
		return null;
	}
	if (!(failed())) {
		pop(4);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocket:receiveUDPDataBuf:start:count: */
EXPORT(sqInt)
primitiveSocketReceiveUDPDataBufCount(void)
{
	sqInt address;
	sqInt addressOop;
	sqInt array;
	char *arrayBase;
	sqInt bytesReceived;
	sqInt count;
	sqInt elementSize;
	sqInt moreFlag;
	sqInt port;
	sqInt results;
	SocketPtr s;
	sqInt socket;
	sqInt startIndex;

	if (!((isIntegerObject((startIndex = stackValue(1))))
		 && (isIntegerObject((count = stackValue(0)))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	socket = stackValue(3);
	array = stackValue(2);
	startIndex = integerValueOf(startIndex);
	count = integerValueOf(count);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	elementSize = 
#  if SPURVM
		bytesPerElement(array)
#  else
		(isWords(array)
				? 4
				: 1)
#  endif
		;
	if (!((isWordsOrBytes(array))
		 && ((elementSize > 0)
		 && ((startIndex >= 1)
		 && ((count >= 0)
		 && (((startIndex + count) - 1) <= (slotSizeOf(array)))))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	arrayBase = ((char *) (firstIndexableField(array)));
	address = (port = (moreFlag = 0));

	/* allocate storage for results, remapping newly allocated
	   oops in case GC happens during allocation */
	bytesReceived = sqSocketReceiveUDPDataBufCountaddressportmoreFlag(s, arrayBase + ((startIndex - 1) * elementSize), count * elementSize, (&address), (&port), (&moreFlag));
	addressOop = intToNetAddress(address);
	
#if SPURVM
	results = instantiateClassindexableSize(classArray(), 4);
#else /* SPURVM */
	pushRemappableOop(addressOop);
	results = instantiateClassindexableSize(classArray(), 4);
	addressOop = popRemappableOop();
#endif /* SPURVM */
	storeIntegerofObjectwithValue(0, results, bytesReceived / elementSize);
	storePointerofObjectwithValue(1, results, addressOop);
	storeIntegerofObjectwithValue(2, results, port);
	storePointerofObjectwithValue(3, results, (moreFlag
		? trueObject()
		: falseObject()));
	if (!(failed())) {
		methodReturnValue(results);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketRemoteAddress: */
EXPORT(sqInt)
primitiveSocketRemoteAddress(void)
{
	sqInt addr;
	SocketPtr s;
	sqInt socket;
	sqInt _return_value;

	socket = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	addr = sqSocketRemoteAddress(s);
	if (!(failed())) {
		_return_value = intToNetAddress(addr);
		if (!(failed())) {
			methodReturnValue(_return_value);
		}
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocket:remoteAddressResult: */
EXPORT(sqInt)
primitiveSocketRemoteAddressResult(void)
{
	char *addrBase;
	sqInt addrSize;
	SocketPtr s;
	sqInt socket;
	sqInt socketAddress;

	socket = stackValue(1);
	socketAddress = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	addrSize = byteSizeOf(socketAddress);
	addrBase = ((char *) (firstIndexableField(socketAddress)));
	if (!(failed())) {
		sqSocketRemoteAddressResultSize(s, addrBase, addrSize);
	}
	if (!(failed())) {
		pop(2);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketRemoteAddressSize: */
EXPORT(sqInt)
primitiveSocketRemoteAddressSize(void)
{
	SocketPtr s;
	sqInt size;
	sqInt socket;

	socket = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (!(failed())) {
		size = sqSocketRemoteAddressSize(s);
		if (!(failed())) {
			methodReturnInteger(size);
			return null;
		}
	}
	if (!(failed())) {
		pop(1);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketRemotePort: */
EXPORT(sqInt)
primitiveSocketRemotePort(void)
{
	SocketPtr s;
	sqInt socket;

	socket = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (!(failed())) {
		methodReturnInteger(sqSocketRemotePort(s));
		return null;
	}
	return 0;
}

	/* SocketPlugin>>#primitiveSocket:sendData:start:count: */
EXPORT(sqInt)
primitiveSocketSendDataBufCount(void)
{
	sqInt array;
	char *arrayBase;
	sqInt bytesSent;
	sqInt count;
	sqInt elementSize;
	SocketPtr s;
	sqInt socket;
	sqInt startIndex;

	bytesSent = 0;
	if (!((isIntegerObject((startIndex = stackValue(1))))
		 && (isIntegerObject((count = stackValue(0)))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	socket = stackValue(3);
	array = stackValue(2);
	startIndex = integerValueOf(startIndex);
	count = integerValueOf(count);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	elementSize = 
#  if SPURVM
		bytesPerElement(array)
#  else
		(isWords(array)
				? 4
				: 1)
#  endif
		;
	if (!((isWordsOrBytes(array))
		 && ((elementSize > 0)
		 && ((startIndex >= 1)
		 && ((count >= 0)
		 && (((startIndex + count) - 1) <= (slotSizeOf(array)))))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	if (!(failed())) {

		/* Note: adjust bufStart for zero-origin indexing */
		arrayBase = ((char *) (firstIndexableField(array)));
		bytesSent = sqSocketSendDataBufCount(s, arrayBase + ((startIndex - 1) * elementSize), count * elementSize);
	}
	if (!(failed())) {
		methodReturnInteger(bytesSent / elementSize);
	}
	return null;
}

	/* SocketPlugin>>#primitiveSocketSendDone: */
EXPORT(sqInt)
primitiveSocketSendDone(void)
{
	SocketPtr s;
	sqInt socket;

	socket = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	if (!(failed())) {
		methodReturnBool(sqSocketSendDone(s));
		return null;
	}
	return 0;
}

	/* SocketPlugin>>#primitiveSocket:sendUDPData:toHost:port:start:count: */
EXPORT(sqInt)
primitiveSocketSendUDPDataBufCount(void)
{
	sqInt array;
	char *arrayBase;
	sqInt bytesSent;
	sqInt count;
	sqInt elementSize;
	char *hostAddress;
	sqInt hostAddressInteger;
	sqInt portNumber;
	SocketPtr s;
	sqInt socket;
	sqInt startIndex;
	sqInt sz;

	bytesSent = 0;
	if (!((isBytes(stackValue(3)))
		 && ((isIntegerObject((portNumber = stackValue(2))))
		 && ((isIntegerObject((startIndex = stackValue(1))))
		 && (isIntegerObject((count = stackValue(0)))))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	socket = stackValue(5);
	array = stackValue(4);
	hostAddress = firstIndexableField(stackValue(3));
	portNumber = integerValueOf(portNumber);
	startIndex = integerValueOf(startIndex);
	count = integerValueOf(count);
	elementSize = 
#  if SPURVM
		bytesPerElement(array)
#  else
		(isWords(array)
				? 4
				: 1)
#  endif
		;
	if (!((isWordsOrBytes(array))
		 && ((elementSize > 0)
		 && ((startIndex >= 1)
		 && ((count >= 0)
		 && (((startIndex + count) - 1) <= (slotSizeOf(array)))))))) {
		return primitiveFailFor(PrimErrBadArgument);
	}
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	/* begin netAddressToInt: */
	sz = byteSizeOf(((sqInt)(sqIntptr_t)((((unsigned char *) hostAddress))) - BaseHeaderSize));
	if (!(sz == 4)) {
		hostAddressInteger = primitiveFail();
		goto l1;
	}
	hostAddressInteger = ((((((unsigned char *) hostAddress))[3]) + (((usqInt)(((((unsigned char *) hostAddress))[2])) << 8))) + (((usqInt)(((((unsigned char *) hostAddress))[1])) << 16))) + (((usqInt)(((*((unsigned char *) hostAddress)))) << 24));
	l1:	/* end netAddressToInt: */;
	if (!(failed())) {

		/* Note: adjust bufStart for zero-origin indexing */
		arrayBase = ((char *) (firstIndexableField(array)));
		bytesSent = sqSockettoHostportSendDataBufCount(s, hostAddressInteger, portNumber, arrayBase + ((startIndex - 1) * elementSize), count * elementSize);
	}
	if (!(failed())) {
		methodReturnInteger(bytesSent / elementSize);
	}
	return null;
}


/*	THIS BADLY NEEDS TO BE REWRITTEN TO TAKE Booleans AND Integers AS WELL AS
	(OR INSTEAD OF) Strings.
	It is only used with booleans and integers and parsing these back out of
	strings in

	sqSocketSetOptions:optionNameStart:optionNameSize:optionValueStart:optionValueSize:returnedValue:
	is STUPID. */

	/* SocketPlugin>>#primitiveSocket:setOptions:value: */
EXPORT(sqInt)
primitiveSocketSetOptions(void)
{
	sqInt errorCode;
	sqInt optionName;
	sqInt optionValue;
	sqInt results;
	sqInt returnedValue;
	SocketPtr s;
	sqInt socket;

	socket = stackValue(2);
	optionName = stackValue(1);
	optionValue = stackValue(0);
	/* begin socketValueOf: */
	if ((isBytes(socket))
	 && ((byteSizeOf(socket)) == (sizeof(SQSocket)))) {
		s = ((SocketPtr) (firstIndexableField(socket)));
	}
	else {
		primitiveFailFor(PrimErrBadArgument);
		s = null;
	}
	success((isBytes(optionName))
	 && (isBytes(optionValue)));
	if (failed()) {
		return null;
	}
	returnedValue = 0;
	errorCode = sqSocketSetOptionsoptionNameStartoptionNameSizeoptionValueStartoptionValueSizereturnedValue(s, ((char *) (firstIndexableField(optionName))), byteSizeOf(optionName), ((char *) (firstIndexableField(optionValue))), byteSizeOf(optionValue), (&returnedValue));
	results = instantiateClassindexableSize(classArray(), 2);
	storeIntegerofObjectwithValue(0, results, errorCode);
	storeIntegerofObjectwithValue(1, results, returnedValue);
	if (!(failed())) {
		methodReturnValue(results);
	}
	return null;
}


/*	Note: This is coded so that it can be run in Squeak. */

	/* InterpreterPlugin>>#setInterpreter: */
EXPORT(sqInt)
setInterpreter(struct VirtualMachine *anInterpreter)
{
	sqInt ok;


	/* This may seem tautological, but in a real plugin it checks that the VM provides
	   the version the plugin was compiled against which is the version the plugin expects. */
	interpreterProxy = anInterpreter;
	ok = ((interpreterProxy->majorVersion()) == (VM_PROXY_MAJOR))
	 && ((interpreterProxy->minorVersion()) >= (VM_PROXY_MINOR));
	if (ok) {
		
#if !defined(SQUEAK_BUILTIN_PLUGIN)
		byteSizeOf = interpreterProxy->byteSizeOf;
#if VM_PROXY_MAJOR > 1 || (VM_PROXY_MAJOR == 1 && VM_PROXY_MINOR >= 17)
		bytesPerElement = interpreterProxy->bytesPerElement;
#else
#if !defined(bytesPerElement)
		bytesPerElement = 0;
#endif
#endif
		classArray = interpreterProxy->classArray;
		classByteArray = interpreterProxy->classByteArray;
		classString = interpreterProxy->classString;
		failed = interpreterProxy->failed;
		falseObject = interpreterProxy->falseObject;
		firstIndexableField = interpreterProxy->firstIndexableField;
		instantiateClassindexableSize = interpreterProxy->instantiateClassindexableSize;
#if !defined(integerValueOf)
		integerValueOf = interpreterProxy->integerValueOf;
#endif
		ioLoadFunctionFrom = interpreterProxy->ioLoadFunctionFrom;
		isBytes = interpreterProxy->isBytes;
#if !defined(isIntegerObject)
		isIntegerObject = interpreterProxy->isIntegerObject;
#endif
		isWords = interpreterProxy->isWords;
		isWordsOrBytes = interpreterProxy->isWordsOrBytes;
		methodArgumentCount = interpreterProxy->methodArgumentCount;
		methodReturnBool = interpreterProxy->methodReturnBool;
		methodReturnInteger = interpreterProxy->methodReturnInteger;
		methodReturnValue = interpreterProxy->methodReturnValue;
		pop = interpreterProxy->pop;
		popRemappableOop = interpreterProxy->popRemappableOop;
		primitiveFail = interpreterProxy->primitiveFail;
		primitiveFailFor = interpreterProxy->primitiveFailFor;
		pushRemappableOop = interpreterProxy->pushRemappableOop;
		slotSizeOf = interpreterProxy->slotSizeOf;
		stackValue = interpreterProxy->stackValue;
		storeIntegerofObjectwithValue = interpreterProxy->storeIntegerofObjectwithValue;
		storePointerofObjectwithValue = interpreterProxy->storePointerofObjectwithValue;
		success = interpreterProxy->success;
		trueObject = interpreterProxy->trueObject;
#endif /* !defined(SQUEAK_BUILTIN_PLUGIN) */
	}
	return ok;
}

	/* SocketPlugin>>#shutdownModule */
EXPORT(sqInt)
shutdownModule(void)
{
	return socketShutdown();
}


#ifdef SQUEAK_BUILTIN_PLUGIN

static char _m[] = "SocketPlugin";
void* SocketPlugin_exports[][3] = {
	{(void*)_m, "getModuleName", (void*)getModuleName},
	{(void*)_m, "initialiseModule", (void*)initialiseModule},
	{(void*)_m, "moduleUnloaded", (void*)moduleUnloaded},
	{(void*)_m, "primitiveDisableSocketAccess\000\377\000", (void*)primitiveDisableSocketAccess},
	{(void*)_m, "primitiveHasSocketAccess\000\377\000", (void*)primitiveHasSocketAccess},
	{(void*)_m, "primitiveInitializeNetwork\000\000\000", (void*)primitiveInitializeNetwork},
	{(void*)_m, "primitiveResolverAbortLookup\000\377\000", (void*)primitiveResolverAbortLookup},
	{(void*)_m, "primitiveResolverAddressLookupResult\000\377\000", (void*)primitiveResolverAddressLookupResult},
	{(void*)_m, "primitiveResolverError\000\377\000", (void*)primitiveResolverError},
	{(void*)_m, "primitiveResolverGetAddressInfo\000\001\000", (void*)primitiveResolverGetAddressInfo},
	{(void*)_m, "primitiveResolverGetAddressInfoFamily\000\377\000", (void*)primitiveResolverGetAddressInfoFamily},
	{(void*)_m, "primitiveResolverGetAddressInfoNext\000\377\000", (void*)primitiveResolverGetAddressInfoNext},
	{(void*)_m, "primitiveResolverGetAddressInfoProtocol\000\377\000", (void*)primitiveResolverGetAddressInfoProtocol},
	{(void*)_m, "primitiveResolverGetAddressInfoResult\000\001\000", (void*)primitiveResolverGetAddressInfoResult},
	{(void*)_m, "primitiveResolverGetAddressInfoSize\000\377\000", (void*)primitiveResolverGetAddressInfoSize},
	{(void*)_m, "primitiveResolverGetAddressInfoType\000\377\000", (void*)primitiveResolverGetAddressInfoType},
	{(void*)_m, "primitiveResolverGetNameInfo\000\001\000", (void*)primitiveResolverGetNameInfo},
	{(void*)_m, "primitiveResolverGetNameInfoHostResult\000\001\000", (void*)primitiveResolverGetNameInfoHostResult},
	{(void*)_m, "primitiveResolverGetNameInfoHostSize\000\377\000", (void*)primitiveResolverGetNameInfoHostSize},
	{(void*)_m, "primitiveResolverGetNameInfoServiceResult\000\001\000", (void*)primitiveResolverGetNameInfoServiceResult},
	{(void*)_m, "primitiveResolverGetNameInfoServiceSize\000\377\000", (void*)primitiveResolverGetNameInfoServiceSize},
	{(void*)_m, "primitiveResolverHostNameResult\000\001\000", (void*)primitiveResolverHostNameResult},
	{(void*)_m, "primitiveResolverHostNameSize\000\377\000", (void*)primitiveResolverHostNameSize},
	{(void*)_m, "primitiveResolverLocalAddress\000\377\000", (void*)primitiveResolverLocalAddress},
	{(void*)_m, "primitiveResolverNameLookupResult\000\377\000", (void*)primitiveResolverNameLookupResult},
	{(void*)_m, "primitiveResolverStartAddressLookup\000\001\000", (void*)primitiveResolverStartAddressLookup},
	{(void*)_m, "primitiveResolverStartNameLookup\000\001\000", (void*)primitiveResolverStartNameLookup},
	{(void*)_m, "primitiveResolverStatus\000\377\000", (void*)primitiveResolverStatus},
	{(void*)_m, "primitiveSocketAbortConnection\000\001\000", (void*)primitiveSocketAbortConnection},
	{(void*)_m, "primitiveSocketAccept\000\001\000", (void*)primitiveSocketAccept},
	{(void*)_m, "primitiveSocketAccept3Semaphores\000\001\000", (void*)primitiveSocketAccept3Semaphores},
	{(void*)_m, "primitiveSocketAddressGetPort\000\001\000", (void*)primitiveSocketAddressGetPort},
	{(void*)_m, "primitiveSocketAddressSetPort\000\001\000", (void*)primitiveSocketAddressSetPort},
	{(void*)_m, "primitiveSocketBindTo\000\001\000", (void*)primitiveSocketBindTo},
	{(void*)_m, "primitiveSocketBindToPort\000\001\000", (void*)primitiveSocketBindToPort},
	{(void*)_m, "primitiveSocketCloseConnection\000\001\000", (void*)primitiveSocketCloseConnection},
	{(void*)_m, "primitiveSocketConnectionStatus\000\001\000", (void*)primitiveSocketConnectionStatus},
	{(void*)_m, "primitiveSocketConnectTo\000\001\000", (void*)primitiveSocketConnectTo},
	{(void*)_m, "primitiveSocketConnectToPort\000\001\000", (void*)primitiveSocketConnectToPort},
	{(void*)_m, "primitiveSocketCreate\000\000\000", (void*)primitiveSocketCreate},
	{(void*)_m, "primitiveSocketCreate3Semaphores\000\000\000", (void*)primitiveSocketCreate3Semaphores},
	{(void*)_m, "primitiveSocketCreateRAW\000\000\000", (void*)primitiveSocketCreateRAW},
	{(void*)_m, "primitiveSocketDestroy\000\001\000", (void*)primitiveSocketDestroy},
	{(void*)_m, "primitiveSocketError\000\001\000", (void*)primitiveSocketError},
	{(void*)_m, "primitiveSocketGetOptions\000\001\000", (void*)primitiveSocketGetOptions},
	{(void*)_m, "primitiveSocketListenOnPort\000\001\000", (void*)primitiveSocketListenOnPort},
	{(void*)_m, "primitiveSocketListenOnPortBacklog\000\001\000", (void*)primitiveSocketListenOnPortBacklog},
	{(void*)_m, "primitiveSocketListenOnPortBacklogInterface\000\001\000", (void*)primitiveSocketListenOnPortBacklogInterface},
	{(void*)_m, "primitiveSocketListenWithBacklog\000\001\000", (void*)primitiveSocketListenWithBacklog},
	{(void*)_m, "primitiveSocketListenWithOrWithoutBacklog\000\001\000", (void*)primitiveSocketListenWithOrWithoutBacklog},
	{(void*)_m, "primitiveSocketLocalAddress\000\001\000", (void*)primitiveSocketLocalAddress},
	{(void*)_m, "primitiveSocketLocalAddressResult\000\001\000", (void*)primitiveSocketLocalAddressResult},
	{(void*)_m, "primitiveSocketLocalAddressSize\000\001\000", (void*)primitiveSocketLocalAddressSize},
	{(void*)_m, "primitiveSocketLocalPort\000\001\000", (void*)primitiveSocketLocalPort},
	{(void*)_m, "primitiveSocketReceiveDataAvailable\000\001\000", (void*)primitiveSocketReceiveDataAvailable},
	{(void*)_m, "primitiveSocketReceiveDataBufCount\000\001\000", (void*)primitiveSocketReceiveDataBufCount},
	{(void*)_m, "primitiveSocketReceiveUDPDataBufCount\000\001\000", (void*)primitiveSocketReceiveUDPDataBufCount},
	{(void*)_m, "primitiveSocketRemoteAddress\000\001\000", (void*)primitiveSocketRemoteAddress},
	{(void*)_m, "primitiveSocketRemoteAddressResult\000\001\000", (void*)primitiveSocketRemoteAddressResult},
	{(void*)_m, "primitiveSocketRemoteAddressSize\000\001\000", (void*)primitiveSocketRemoteAddressSize},
	{(void*)_m, "primitiveSocketRemotePort\000\001\000", (void*)primitiveSocketRemotePort},
	{(void*)_m, "primitiveSocketSendDataBufCount\000\001\000", (void*)primitiveSocketSendDataBufCount},
	{(void*)_m, "primitiveSocketSendDone\000\001\000", (void*)primitiveSocketSendDone},
	{(void*)_m, "primitiveSocketSendUDPDataBufCount\000\001\000", (void*)primitiveSocketSendUDPDataBufCount},
	{(void*)_m, "primitiveSocketSetOptions\000\001\000", (void*)primitiveSocketSetOptions},
	{(void*)_m, "setInterpreter", (void*)setInterpreter},
	{(void*)_m, "shutdownModule", (void*)shutdownModule},
	{NULL, NULL, NULL}
};

#else // ifdef SQ_BUILTIN_PLUGIN

#if SPURVM
EXPORT(signed short) primitiveInitializeNetworkMetadata = 0;
EXPORT(signed short) primitiveResolverGetAddressInfoMetadata = 0x100;
EXPORT(signed short) primitiveResolverGetAddressInfoResultMetadata = 0x100;
EXPORT(signed short) primitiveResolverGetNameInfoMetadata = 0x100;
EXPORT(signed short) primitiveResolverGetNameInfoHostResultMetadata = 0x100;
EXPORT(signed short) primitiveResolverGetNameInfoServiceResultMetadata = 0x100;
EXPORT(signed short) primitiveResolverHostNameResultMetadata = 0x100;
EXPORT(signed short) primitiveResolverStartAddressLookupMetadata = 0x100;
EXPORT(signed short) primitiveResolverStartNameLookupMetadata = 0x100;
EXPORT(signed short) primitiveSocketAbortConnectionMetadata = 0x100;
EXPORT(signed short) primitiveSocketAcceptMetadata = 0x100;
EXPORT(signed short) primitiveSocketAccept3SemaphoresMetadata = 0x100;
EXPORT(signed short) primitiveSocketAddressGetPortMetadata = 0x100;
EXPORT(signed short) primitiveSocketAddressSetPortMetadata = 0x100;
EXPORT(signed short) primitiveSocketBindToMetadata = 0x100;
EXPORT(signed short) primitiveSocketBindToPortMetadata = 0x100;
EXPORT(signed short) primitiveSocketCloseConnectionMetadata = 0x100;
EXPORT(signed short) primitiveSocketConnectionStatusMetadata = 0x100;
EXPORT(signed short) primitiveSocketConnectToMetadata = 0x100;
EXPORT(signed short) primitiveSocketConnectToPortMetadata = 0x100;
EXPORT(signed short) primitiveSocketCreateMetadata = 0;
EXPORT(signed short) primitiveSocketCreate3SemaphoresMetadata = 0;
EXPORT(signed short) primitiveSocketCreateRAWMetadata = 0;
EXPORT(signed short) primitiveSocketDestroyMetadata = 0x100;
EXPORT(signed short) primitiveSocketErrorMetadata = 0x100;
EXPORT(signed short) primitiveSocketGetOptionsMetadata = 0x100;
EXPORT(signed short) primitiveSocketListenOnPortMetadata = 0x100;
EXPORT(signed short) primitiveSocketListenOnPortBacklogMetadata = 0x100;
EXPORT(signed short) primitiveSocketListenOnPortBacklogInterfaceMetadata = 0x100;
EXPORT(signed short) primitiveSocketListenWithBacklogMetadata = 0x100;
EXPORT(signed short) primitiveSocketListenWithOrWithoutBacklogMetadata = 0x100;
EXPORT(signed short) primitiveSocketLocalAddressMetadata = 0x100;
EXPORT(signed short) primitiveSocketLocalAddressResultMetadata = 0x100;
EXPORT(signed short) primitiveSocketLocalAddressSizeMetadata = 0x100;
EXPORT(signed short) primitiveSocketLocalPortMetadata = 0x100;
EXPORT(signed short) primitiveSocketReceiveDataAvailableMetadata = 0x100;
EXPORT(signed short) primitiveSocketReceiveDataBufCountMetadata = 0x100;
EXPORT(signed short) primitiveSocketReceiveUDPDataBufCountMetadata = 0x100;
EXPORT(signed short) primitiveSocketRemoteAddressMetadata = 0x100;
EXPORT(signed short) primitiveSocketRemoteAddressResultMetadata = 0x100;
EXPORT(signed short) primitiveSocketRemoteAddressSizeMetadata = 0x100;
EXPORT(signed short) primitiveSocketRemotePortMetadata = 0x100;
EXPORT(signed short) primitiveSocketSendDataBufCountMetadata = 0x100;
EXPORT(signed short) primitiveSocketSendDoneMetadata = 0x100;
EXPORT(signed short) primitiveSocketSendUDPDataBufCountMetadata = 0x100;
EXPORT(signed short) primitiveSocketSetOptionsMetadata = 0x100;
#endif // SPURVM

#endif // ifdef SQ_BUILTIN_PLUGIN
