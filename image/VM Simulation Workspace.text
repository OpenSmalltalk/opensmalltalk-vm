"To build the spurreader or spurreader-64 images used in the examples below run one of	buildspurtrunkreaderimage.sh	buildspurtrunkreader64image.shThe reader images include a simple REPL loop that reads a chunk-format expression from stdin, evaluates it and writes the printString of the result to stdout.  In the simulator you are prompted for input via an input widget and writes output to the Transcript.  e.g. try 3+4!.  On the Transcript you should seesqueak> 7squeak> ""Run the Cog VM simulator on a 64-bit Spur image (by default the Spur trunk 4.6 image, complex options are in the Cog example below)"[| cos |cos := CogVMSimulator newWithOptions: #(Cogit StackToRegisterMappingCogit "SimpleStackBasedCogit"										ObjectMemory Spur64BitCoMemoryManager										MULTIPLEBYTECODESETS true),										{#ISA. Cogit choose64BitISA}."cos initializeThreadSupport."cos desiredNumStackPages: 8.cos openOn: 'spurreader-64'.cos openAsMorph; run]."Run the Stack VM simulator on a 64-bit Spur image (by default the Spur trunk 4.6 image, complex options are in the Cog example below)"[| sis |sis := StackInterpreterSimulator newWithOptions: #(ObjectMemory Spur64BitMemoryManager													MULTIPLEBYTECODESETS true).sis desiredNumStackPages: 8.sis assertValidExecutionPointersAtEachStep: false. "Set this to true to turn on an expensive assert that checks for valid stack, frame pointers etc on each bytecode.  Useful when you're adding new bytecodes or exotic execution primitives."sis openOn: 'spurreader-64'.sis openAsMorph; run]."Run the Cog VM simulator on a 32-bit Spur image (by default the Spur trunk 4.6 image, complex options are in the Cog example below)"[| cos |cos := CogVMSimulator newWithOptions: #(Cogit StackToRegisterMappingCogit "SimpleStackBasedCogit"										ObjectMemory Spur32BitCoMemoryManager										MULTIPLEBYTECODESETS true),										{#ISA. Cogit choose32BitISA}."cos initializeThreadSupport."cos desiredNumStackPages: 8. "Speeds up scavenging when simulating.  Set to e.g. 64 for something like the real VM."cos openOn: 'spurreader'.cos openAsMorph; run]."Run the Stack VM simulator on a 32-bit Spur image (by default the Spur trunk 4.6 image, complex options are in the Cog example below)"[| sis |sis := StackInterpreterSimulator newWithOptions: #(ObjectMemory Spur32BitMemoryManager													MULTIPLEBYTECODESETS true).sis desiredNumStackPages: 8. "Speeds up scavenging when simulating.  Set to e.g. 64 for something like the real VM."sis assertValidExecutionPointersAtEachStep: false. "Set this to true to turn on an expensive assert that checks for valid stack, frame pointers etc on each bytecode.  Useful when you're adding new bytecodes or exotic execution primitives."sis openOn: 'spurreader'.sis openAsMorph; run]."Run the Cog VM simulator on a 32-bit Cog image (by default the Squeak 4.5 image:).  Note the plethora of optional debug features in comments."[| cos proc opts |cos := CogVMSimulator newWithOptions: #(Cogit StackToRegisterMappingCogit "SimpleStackBasedCogit"											MULTIPLEBYTECODESETS true),											{#ISA. Cogit choose32BitISA}."cos initializeThreadSupport."cos desiredNumStackPages: 8.cos openOn: 'Squeak-4.5-All-in-One.app/Contents/Resources/Squeak4.5-13680'.false ifTrue:	[cos systemAttributes		at: 2 put: '-doit';		at: 3 put:	'ShootoutTests runAllToTranscript.  Smalltalk quitPrimitive']."cos cogit breakPC: 16r2697.""cos cogit traceStores: true.""cos cogit sendTrace: 6." "trace prims & print""cos cogit singleStep: true.""cos cogit printInstructions: true.""cos linkSends: false.""cos enableCog: false.""cos setBreakSelector: 'standardIOStreamNamed:forWrite:'.""cos cogit setBreakMethod: 16rCE1630.""cos cogit	cog: 16rAB0B28 + cos startOfMemory	selector: 16r31F280 + cos startOfMemory." "e.g. jit a specific method without simulating"cos openAsMorph; run]."----ACCEPT----2024-09-26T15:51:23.565858-07:00""To build the spurreader or spurreader-64 images used in the examples below run one of	buildspurtrunkreaderimage.sh	buildspurtrunkreader64image.shThe reader images include a simple REPL loop that reads a chunk-format expression from stdin, evaluates it and writes the printString of the result to stdout.  In the simulator you are prompted for input via an input widget and writes output to the Transcript.  e.g. try 3+4!.  On the Transcript you should seesqueak> 7squeak> "	[| cos |cos := CogVMSimulator newWithOptions: #(COGMTVM true											Cogit StackToRegisterMappingCogit "SimpleStackBasedCogit"											ObjectMemory Spur64BitCoMemoryManager											MULTIPLEBYTECODESETS true "linkedSendTrace true"											"LRPCheck true"											haltOnExecuteMethod "true" false											profiling false											ISA ARMv8 DUAL_MAPPED_CODE_ZONE true)											"{#ISA. Cogit choose64BitISA}"."cos initializeThreadSupport."cos desiredNumStackPages: 8. "Speeds up scavenging when simulating.  Set to e.g. 64 for something like the real VM."cos openOn: 'spurreader-64-preen'.cos openAsMorph; halt; run].[| cos |cos := CogVMSimulator newWithOptions: #("COGMTVM true"											Cogit StackToRegisterMappingCogit "SimpleStackBasedCogit"											ObjectMemory Spur64BitCoMemoryManager											MULTIPLEBYTECODESETS true "linkedSendTrace true"											"LRPCheck true"											haltOnExecuteMethod "true" false											profiling false											disableOSProcess true											"ISA ARMv8 DUAL_MAPPED_CODE_ZONE true")											,{#ISA. Cogit choose64BitISA}."cos initializeThreadSupport."cos desiredNumStackPages: 8. "Speeds up scavenging when simulating.  Set to e.g. 64 for something like the real VM.""cos openOn: '/Users/eliot/Squeak/Squeak6.0/trunk6-64'."cos openOn: '/Users/eliot/Squeak/Squeak6.0/crashtestdummy'."cos openOn: 'spurreader-64'.""cos openOn: 'foo'.""cos openOn: '~/Squeak/Cuis-Smalltalk-Dev/Cuis5.0-4191-play'.""cos systemAttributes		at: 2 put: '-doit';		at: 3 put:	'Smalltalk vmParameterAt: 67 put: 128*1024*1024; useUpMemoryWithArrays'."cos openAsMorph; halt; run]."Run the Cog VM simulator on a Spur image (by default the Spur trunk 4.6 image, complex options are in the Cog example below)"[| cos |cos := CogVMSimulator newWithOptions: #("COGMTVM true"											Cogit StackToRegisterMappingCogit "SimpleStackBasedCogit"											ObjectMemory Spur32BitCoMemoryManager											MULTIPLEBYTECODESETS true "linkedSendTrace true"											LRPCheck true											haltOnExecuteMethod "true" false											profiling false),											{#ISA. Cogit choose32BitISA}."cos initializeThreadSupport."cos desiredNumStackPages: 8. "Speeds up scavenging when simulating.  Set to e.g. 64 for something like the real VM.""cos openOn: '/Users/eliot/Squeak/Squeak5.3/trunk6-32'."cos openOn: '/Users/eliot/Squeak/Squeak6.0/seahaven-32'."cos openOn: 'spurreader-32'."cos openAsMorph; halt; run]."Run the 32-bit Stack VM simulator on a Spur image"[| sis |sis := StackInterpreterSimulator newWithOptions: #(ObjectMemory Spur32BitMemoryManager 													MULTIPLEBYTECODESETS true).sis desiredNumStackPages: 8. "Speeds up scavenging when simulating.  Set to e.g. 64 for something like the real VM."sis openOn: 'spurreader'.sis openAsMorph; halt; run]."Run the 64-bit Stack VM simulator on a Spur image"[| sis |sis := StackInterpreterSimulator newWithOptions: #(ObjectMemory Spur64BitMemoryManager														"MULTIPLEBYTECODESETS true"														haltOnExecuteMethod false														disableOSProcess true).sis desiredNumStackPages: 16. "Speeds up scavenging when simulating.  Set to e.g. 64 for something like the real VM.""sis openOn: '/Users/eliot/Squeak/Squeak5.3/trunk6-64'.""sis openOn: '/Users/eliot/Squeak/Squeak6.0/trunk6-64'.""sis openOn: 'foo'.""sis setBreakSelector: #lowSpaceWatcher.""sis objectMemory setMaxOldSpaceSize: 128*1024*1024.""sis systemAttributes		at: 2 put: '-doit';		at: 3 put:	'Smalltalk installLowSpaceWatcher; useUpMemoryWithArrays'.""sis openOn: 'spurreader-64'."sis openOn: '~/cuis/Cuis-Smalltalk-Dev/cuis71test'.sis setBreakSelector: #startUp:"#getSystemAttribute:""#isForCurrentPlatform""#primitiveCalloutWithArgs".sis openAsMorph; halt; run].[| objectMemory |objectMemory findString: #testLibcQsort.objectMemory findString: #yourself.objectMemory storePointer: 35 ofObject: 16r231D850 withValue: 16r1075898]."Run the Cog VM simulator on a Cog image (by default the Squeak 4.5 image:).  Note the plethora of optional debug features in comments."[| cos proc opts |cos := CogVMSimulator newWithOptions: #(ObjectMemory NewCoObjectMemory											Cogit StackToRegisterMappingCogit "SimpleStackBasedCogit"											ISA ARMv5)."cos initializeThreadSupport."cos desiredNumStackPages: 8.cos openOn: 'v3reader'			"'/Users/eliot/Squeak/Squeak4.6/FunSqueak4.6-14870'"			"'Squeak-4.5-All-in-One.app/Contents/Resources/Squeak4.5-13680'".false ifTrue:	[cos systemAttributes		at: 2 put: '-doit';		at: 3 put:	'ShootoutTests runAllToTranscript.  Smalltalk quitPrimitive'].cos systemAttributes at: 2 put: 'LoadReader.st'."cos cogit breakPC: 16r2697.""cos cogit traceStores: true.""cos cogit sendTrace: 6." "trace prims & print""cos cogit singleStep: true.""cos cogit printInstructions: true.""cos linkSends: false.""cos enableCog: false.""cos setBreakSelector: 'standardIOStreamNamed:forWrite:'.""cos cogit setBreakMethod: 16rCE1630.""cos cogit	cog: 16rAB0B28 + cos startOfMemory	selector: 16r31F280 + cos startOfMemory." "e.g. jit a specific method without simulating"cos openAsMorph; halt; run]."Run the StackInterpreterSimulator on a Cog image (by default the Squeak 4.5 image:)."[| sis |sis := StackInterpreterSimulator newWithOptions: #(ObjectMemory NewObjectMemory)."sis initializeThreadSupport."sis desiredNumStackPages: 8.sis openOn: '/Users/eliot/Squeak/Squeak4.6/FunSqueak4.6-14870'			"'Squeak-4.5-All-in-One.app/Contents/Resources/Squeak4.5-13680'".false ifTrue:	[sis systemAttributes		at: 2 put: '-doit';		at: 3 put:	'ShootoutTests runAllToTranscript.  Smalltalk quitPrimitive']."sis setBreakSelector: 'standardIOStreamNamed:forWrite:'."sis openAsMorph; halt; run]."Run the Stack VM simulator on a 64-bit Spur image (by default the Spur trunk 4.6 image, complex options are in the Cog example below)"[| sis |sis := StackInterpreterSimulator newWithOptions: #(ObjectMemory Spur64BitMemoryManager													MULTIPLEBYTECODESETS true													haltOnExecuteMethod false haltOnFileDelete false).sis desiredNumStackPages: 8."sis objectMemory setCheckForLeaks: 63.""sis systemAttributes at: 2 put: 'ephemerons/ephemeron-crash.1.cs'.""sis systemAttributes		at: 2 put: '-doit';		at: 3 put:	'EphemeronLink crashImage'.""sis setBreakSelector: #condenseNewSymbols.""sis openOn: 'ephemeron64crash'.""sis openOn: '/Users/eliot/Squeak/Squeak5.3/tests6-64'.""sis openOn: '/Users/eliot/Squeak/Squeak5.3/trunk6-64'.""sis objectMemory setCheckForLeaks: (VMBasicConstants classPool at: #GCCheckShorten)."sis openOn: 'spurreader-64'.sis openAsMorph; halt; run]."Run the Cog VM simulator on a 64-bit Spur image (by default the Spur trunk 4.6 image, complex options are in the Cog example below)""408 [:address| address = 16r408 and: [processor r1 - processor r0 > 1000000]] set break block..."[SoundBuffer allInstances do: [:sb| 1 to: sb basicSize do: [:i| | v | v := sb instVarAt: i. sb instVarAt: i put: v. v ~= (sb instVarAt: i) ifTrue: [self halt]]]].[| cos |cos := CogVMSimulator newWithOptions: #("COGMTVM true"											"desiredCogCodeSize 786432"											Cogit StackToRegisterMappingCogit "SimpleStackBasedCogit"											ObjectMemory Spur64BitCoMemoryManager											MULTIPLEBYTECODESETS true											haltOnExecuteMethod "true" false haltOnFileDelete false __APPLE__ true),											"#(profiling true),"											"#(ISA ARMv8 __APPLE__ true )"											{#ISA. Cogit choose64BitISA}."cos initializeThreadSupport.""cos desiredNumStackPages: 8.""cos cogit sendTrace: 512.""cos openOn: '/Users/eliot/Squeak/Squeak5.3/tests6-64'.""cos openOn: 'ephemeron64'.""cos objectMemory setCheckForLeaks: (VMBasicConstants classPool at: #GCCheckShorten).""cos setBreakSelector: #MiscPrimitivePlugin."cos openOn: 'spurreader-64'.cos openAsMorph; halt; run].[| cos |cos := CogVMSimulator newWithOptions: #(Cogit StackToRegisterMappingCogit "SimpleStackBasedCogit"											ObjectMemory Spur64BitCoMemoryManager											MULTIPLEBYTECODESETS true											haltOnExecuteMethod true haltOnFileDelete false),											{#ISA. Cogit choose64BitISA}."cos initializeThreadSupport."cos desiredNumStackPages: 12.cos openOn: 'spurreader-64'"'/Users/eliot/Squeak/Squeak5.3/trunk6-64'".cos openAsMorph; halt; run].[| cos |cos := CogVMSimulator newWithOptions: #(Cogit "StackToRegisterMappingCogit" SimpleStackBasedCogit											ObjectMemory NewCoObjectMemory "Spur32BitCoMemoryManager"											"MULTIPLEBYTECODESETS true"											haltOnExecuteMethod false haltOnFileDelete false),											{#ISA. Cogit choose32BitISA}."cos initializeThreadSupport."cos desiredNumStackPages: 8."cos objectMemory setCheckForLeaks: (VMBasicConstants classPool at: #GCCheckShorten).""cos openOn: 'spurreader'."cos openOn: '~/Squeak/Cuis-Smalltalk-Dev/Cuis5.0-4520-v3'.cos openAsMorph; halt; run]